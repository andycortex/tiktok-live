generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model user {
  id        Int      @id @default(autoincrement())
  nombre    String
  apellido  String
  email     String   @unique
  password  String
  whatsapp  String
  ciudad    String
  direccion String
  empresa   String
  tiktok    String
  passwordResetToken   String?   @unique
  passwordResetExpires DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  role      Role     @default(USER)

  // Relations
  ownedProducts product[]     @relation("ProductOwner")
  affiliations  affiliation[]
  sales         order[]       @relation("SellerOrders")
}

enum Role {
  USER
  VENDEDOR
  PROPIETARIO
}

model product {
  id          Int      @id @default(autoincrement())
  name        String
  code        String   @unique
  category    String
  price       Float
  stock       Int
  commissionPercentage Float @default(0)
  visibility  String   @default("public")
  status      String   @default("active")
  description String?
  image       String?  @db.LongText
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  

  
  // Relations
  ownerId     Int
  owner       user     @relation("ProductOwner", fields: [ownerId], references: [id])
  orderItems  orderItem[]
  affiliations affiliation[]
  images      ProductImage[]
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  url       String   @db.LongText
  productId Int
  product   product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model affiliation {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      user     @relation(fields: [userId], references: [id])
  productId Int
  product   product  @relation(fields: [productId], references: [id])
  status    String   @default("PENDING") // PENDING, ACTIVE, REJECTED
  commission Float?  @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, productId])
}

model zone {
  id           Int      @id @default(autoincrement())
  name         String
  region       String
  price        Float
  deliveryTime String
  instructions String?
  schedule     String?
  coverage     String?
  status       String   @default("active")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  orders       order[]
}

model order {
  id            Int         @id @default(autoincrement())
  customerName  String
  customerPhone String
  status        String      @default("pendiente") // pendiente, confirmado, en_camino, entregado, cancelado
  total         Float
  shippingCost  Float
  
  // Relations
  sellerId      Int?
  seller        user?       @relation("SellerOrders", fields: [sellerId], references: [id])
  zoneId        Int?
  zone          zone?       @relation(fields: [zoneId], references: [id])
  items         orderItem[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model orderItem {
  id        Int      @id @default(autoincrement())
  orderId   Int
  order     order    @relation(fields: [orderId], references: [id])
  productId Int
  product   product  @relation(fields: [productId], references: [id])
  quantity  Int
  price     Float
}